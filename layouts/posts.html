<!DOCTYPE html>

<html>
	
	<head>
		<link rel = "stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	</head>
	<!-- define app -->
	<body ng-app='app'>
		<!-- assign angular controller-->
		<div ng-controller='PostsCtrl' class="container">
			<h1>Recent Posts</h1>
			
			<!-- ng-model hooks the input to a $scope property -->
			<input ng-model = 'postBody' class="form-control"/>
			<!-- ng-click -->
			<button ng-click="addPost()" class="btn btn-default">Add Post</button>
			
			<ul class="list-group">
				<!-- ng-repeat-->
				<li ng-repeat ="post in posts | orderBy:'-date'" class="list-group-item">
					<strong>@{{post.username}}</strong>
					<span>{{post.body}}</span>					
				</li>
			</ul>
			
		</div>
		
		
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
		<script>
			
			//create app module
			var app= angular.module('app',[]);
			
			//create angular controller called PostsCtrl
			app.controller('PostsCtrl', function($scope, $http){
				
				// $scope.posts = [
				// 	{
				// 		username:'graylien',
				// 		body:'hola...'
						
				// 	},
				// 	{
				// 		username:'graeme',
				// 		body:'testing angular...'
				// 	}
				// ]
				
				$http.get('api/posts')
				.success(function(posts){
					
					$scope.posts = posts;
					
				})
				
				//add to scope.posts array
				$scope.addPost = function(){
					//if postbody input is not empty, add post 
					if($scope.postBody){
						
						$http.post('api/posts',{
							username:'barry',
							body:$scope.postBody //this is the input field	
						} ).success(function(post){
							
							$scope.posts.unshift(post)
							$scope.postBody = null;
						})
						// $scope.posts.unshift({
						// 	username:'barry',
						// 	body:$scope.postBody //this is the input field	
						// })
						
						//clear input field
						$scope.postBody = null;
					}
				}
				
				
			})
		</script>
	
	</body>
	
</html>